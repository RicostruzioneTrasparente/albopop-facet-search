<es-list>

    <div each="{ opts.items }" class="list-item panel panel-default"><yield/></div>
    <nav>
        <ul class="pagination pagination-sm">
            <li class="list-page" ref="prev" data-value="0"><a href="#" onclick="{ this.submit }"><span>{ opts.prev }</span></a></li>
            <li each="{ page in opts.pages }" class="list-page" data-value="{ page }"><a onclick="{ this.submit }"><span>{ page+1 }</span></a></li>
            <li class="list-page" ref="next" data-value="1"><a href="#" onclick="{ this.submit }"><span>{ opts.next }</span></a></li>
        </ul>
    </nav>

    <style>
        :scope .list-page {
            cursor: pointer;
        }
    </style>

    <script>

        var tag = this;

        tag.on('mount', function() {
            tag.opts.size = +tag.opts.size || 10;
            tag.opts.prev = tag.opts.prev || "Previous";
            tag.opts.next = tag.opts.next || "Next";
        });

        tag.on('update', function() {
            var num_pages = Math.floor(tag.opts.total / tag.opts.size) + 1;
            tag.opts.pages = Array.apply(null, Array(num_pages)).map(function (_, i) {return i;});
        });

        tag.on('updated', function() {
            if (!tag.root.querySelectorAll(".active").length) {
                tag.root.querySelectorAll(".list-page")[1].classList.add("active");
            }
        });

        tag.submit = function(e) {
            var page = +e.currentTarget.parentNode.dataset.value;
            tag.root.querySelectorAll(".active").forEach(function(el) {
                el.classList.remove("active");
            });
            tag.root.querySelectorAll(".list-page")[page+1].classList.add("active");
            tag.refs.prev.dataset.value = Math.max(page - 1, 0);
            tag.refs.next.dataset.value = Math.min(page + 1, Math.floor(tag.opts.total / tag.opts.size));
            tag.trigger('submit', { value: page*tag.opts.size });
            if (e) e.preventDefault();
        };

    </script>

</es-list>
